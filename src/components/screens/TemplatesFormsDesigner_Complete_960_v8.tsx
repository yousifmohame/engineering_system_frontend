/**
 * Ø§Ù„Ø´Ø§Ø´Ø© 960 - Ù…ØµÙ…Ù… Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ ÙˆØ§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… v8.0
 * ====================================================
 * 
 * Ø´Ø§Ø´Ø© Ù…ØªÙ‚Ø¯Ù…Ø© Ø¬Ø¯Ø§Ù‹ Ù„ØªØµÙ…ÙŠÙ… ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ ÙˆØ§Ù„Ù†Ù…Ø§Ø°Ø¬ Ù…Ø¹:
 * 
 * âœ¨ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:
 * - Ù…Ø­Ø±Ø± Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª (Drag & Drop) ÙƒØ§Ù…Ù„
 * - Ø¯Ø¹Ù… 10 Ø£Ù†ÙˆØ§Ø¹ Ù…Ù† Ø§Ù„Ø¹Ù†Ø§ØµØ±
 * - Ù†Ø¸Ø§Ù… ØªÙƒÙˆÙŠØ¯ Ø«Ù†Ø§Ø¦ÙŠ Ù…ØªÙ‚Ø¯Ù…
 * - Ø±Ø¨Ø· Ø¥Ù„Ø²Ø§Ù…ÙŠ Ø¨Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª ÙˆØ£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª
 * - Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© (6 ØµÙŠØº)
 * - Ù†Ø¸Ø§Ù… Versioning Ø´Ø§Ù…Ù„
 * - Ø§Ù„ØªØ¬Ù…ÙŠØ¯ ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
 * - Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
 * - Ø±Ø¨Ø· ÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
 * 
 * ğŸ”— Ø§Ù„Ø±Ø¨Ø· Ø¨Ø§Ù„Ø´Ø§Ø´Ø§Øª:
 * - 942: Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª (Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª)
 * - 701: Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª (Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª)
 * - Ø§Ù„Ø¹Ù…Ù„Ø§Øª: Ù„Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø§Ù„ÙŠØ© (Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹)
 * 
 * ğŸ“‹ Ø§Ù„ØªØ§Ø¨Ø§Øª (15):
 * 960-01: Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
 * 960-02: Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨
 * 960-03: Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
 * 960-04: Ù…ØµÙ…Ù… Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ (Drag & Drop)
 * 960-05: Ù…ØµÙ…Ù… Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ (Drag & Drop)
 * 960-06: Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØµÙ…ÙŠÙ…
 * 960-07: Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
 * 960-08: Ø§Ù„Ø£Ø®ØªØ§Ù… ÙˆØ§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª
 * 960-09: Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù…ÙŠ
 * 960-10: Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ§Ù„ØªØµØ¯ÙŠØ±
 * 960-11: Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª (Versioning)
 * 960-12: Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØ§Ù„ØªØ¬Ù…ÙŠØ¯
 * 960-13: ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
 * 960-14: Ø§Ù„Ø±Ø¨Ø· Ø¨Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
 * 960-15: Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
 * 
 * @version 8.0
 * @date 2025-10-20
 */

import React, { useState, useRef, DragEvent } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '../ui/card';
import { Badge } from '../ui/badge';
import { Button } from '../ui/button';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '../ui/table';
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogFooter } from '../ui/dialog';
import { ScrollArea } from '../ui/scroll-area';
import { Separator } from '../ui/separator';
import {
  Layout, FileText, File, Layers, Edit, Trash2, Save, Copy, Eye,
  Plus, Download, Upload, Lock, Unlock, History, Settings, BarChart3,
  Image as ImageIcon, Type, Hash, AtSign, DollarSign, Calendar,
  CheckSquare, Square, Circle, Star, Triangle, Hexagon, Stamp,
  FileSignature, Shield, Link2, Tag, Folder, FolderTree, Activity,
  AlertCircle, CheckCircle, Clock, Users, Repeat, GitBranch,
  Maximize2, Minimize2, ZoomIn, ZoomOut, RotateCw, Palette,
  AlignLeft, AlignCenter, AlignRight, AlignJustify, Bold, Italic,
  Underline, List, Grid3x3, Move, Trash, X, Search, Filter,
  Code, Building, PlayCircle, PauseCircle, Info, TrendingUp
} from 'lucide-react';
import { InputWithCopy, TextAreaWithCopy, SelectWithCopy } from '../InputWithCopy';
import { EnhancedSwitch } from '../EnhancedSwitch';

// ===== ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª =====

// Ø¹Ù†ØµØ± Ø§Ù„ØªØµÙ…ÙŠÙ…
interface DesignElement {
  id: string;
  type: 'text' | 'image' | 'logo' | 'stamp' | 'signature' | 'field' | 'barcode' | 'qrcode' | 'shape' | 'digital-auth';
  x: number;
  y: number;
  width: number;
  height: number;
  content?: string;
  imageUrl?: string;
  fontSize?: number;
  fontFamily?: string;
  fontWeight?: string;
  textAlign?: string;
  color?: string;
  backgroundColor?: string;
  borderColor?: string;
  borderWidth?: number;
  rotation?: number;
  opacity?: number;
  locked?: boolean;
  layer?: number;
  properties?: any;
}

// Ù…ØªØºÙŠØ± Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ
interface Variable {
  id: string;
  code: string;
  name: string;
  type: 'text' | 'number' | 'date' | 'currency' | 'boolean' | 'list';
  defaultValue?: any;
  format?: string;
  required: boolean;
  validation?: string;
}

// Ø¥ØµØ¯Ø§Ø±
interface Version {
  id: string;
  version: string;
  description: string;
  changedBy: string;
  changedDate: string;
  changes: string[];
  snapshot: any;
}

// Ø§Ù„Ù‚Ø§Ù„Ø¨/Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
interface Template {
  id: string;
  code: string;
  name: string;
  description: string;
  type: 'template' | 'form';
  category: string;
  documentNameId: string;
  documentNameCode: string;
  documentName: string;
  classificationId?: string;
  classificationName?: string;
  width: number;
  height: number;
  orientation: 'portrait' | 'landscape';
  elements: DesignElement[];
  variables: Variable[];
  version: string;
  versionHistory: Version[];
  isActive: boolean;
  isFrozen: boolean;
  frozenBy?: string;
  frozenDate?: string;
  frozenReason?: string;
  usageCount: number;
  lastUsed?: string;
  createdBy: string;
  createdDate: string;
  modifiedBy?: string;
  modifiedDate?: string;
  permissions: string[];
  tags: string[];
}

// Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª (Ù…Ù† Ø´Ø§Ø´Ø© 942)
const DOCUMENT_NAMES = [
  { id: 'DN-001', code: 'ID-COPY', name: 'ØµÙˆØ±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ©' },
  { id: 'DN-002', code: 'DEED-COPY', name: 'ØµÙˆØ±Ø© Ø§Ù„ØµÙƒ' },
  { id: 'DN-003', code: 'ARCH-PLAN', name: 'Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠ' },
  { id: 'DN-004', code: 'STRUCT-PLAN', name: 'Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø¥Ù†Ø´Ø§Ø¦ÙŠ' },
  { id: 'DN-005', code: 'SURVEY-REPORT', name: 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø³Ø­' },
  { id: 'DN-006', code: 'LICENSE-COPY', name: 'ØµÙˆØ±Ø© Ø§Ù„ØªØ±Ø®ÙŠØµ' },
  { id: 'DN-007', code: 'CONTRACT', name: 'Ø§Ù„Ø¹Ù‚Ø¯' },
  { id: 'DN-008', code: 'INVOICE', name: 'Ø§Ù„ÙØ§ØªÙˆØ±Ø©' },
  { id: 'DN-009', code: 'RECEIPT', name: 'Ø³Ù†Ø¯ Ø§Ù„Ù‚Ø¨Ø¶' },
  { id: 'DN-010', code: 'QUOTATION', name: 'Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±' },
];

// Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª (Ù…Ù† Ø´Ø§Ø´Ø© 701)
const CLASSIFICATIONS = [
  { id: 'CL-001', code: 'OFFICIAL', name: 'ÙˆØ«Ø§Ø¦Ù‚ Ø±Ø³Ù…ÙŠØ©' },
  { id: 'CL-002', code: 'ENGINEERING', name: 'ÙˆØ«Ø§Ø¦Ù‚ Ù‡Ù†Ø¯Ø³ÙŠØ©' },
  { id: 'CL-003', code: 'FINANCIAL', name: 'ÙˆØ«Ø§Ø¦Ù‚ Ù…Ø§Ù„ÙŠØ©' },
  { id: 'CL-004', code: 'LEGAL', name: 'ÙˆØ«Ø§Ø¦Ù‚ Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©' },
  { id: 'CL-005', code: 'TECHNICAL', name: 'ÙˆØ«Ø§Ø¦Ù‚ ÙÙ†ÙŠØ©' },
];

const TemplatesFormsDesigner_Complete_960_v8: React.FC = () => {
  const [activeTab, setActiveTab] = useState('960-01');
  const [selectedTemplate, setSelectedTemplate] = useState<Template | null>(null);
  const [designElements, setDesignElements] = useState<DesignElement[]>([]);
  const [selectedElement, setSelectedElement] = useState<DesignElement | null>(null);
  const [isDragging, setIsDragging] = useState(false);
  const [draggedElementType, setDraggedElementType] = useState<string | null>(null);
  const [canvasZoom, setCanvasZoom] = useState(100);
  const [showGrid, setShowGrid] = useState(true);
  const [showRulers, setShowRulers] = useState(true);
  const [showCreateDialog, setShowCreateDialog] = useState(false);
  const [showVersionDialog, setShowVersionDialog] = useState(false);
  const [showFreezeDialog, setShowFreezeDialog] = useState(false);
  const canvasRef = useRef<HTMLDivElement>(null);

  // Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù‚Ø§Ù„Ø¨/Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯
  const [newTemplate, setNewTemplate] = useState({
    name: '',
    description: '',
    type: 'template' as 'template' | 'form',
    documentNameId: '',
    documentNameCode: '',
    documentName: '',
    classificationId: '',
    classificationName: '',
    category: '',
    orientation: 'portrait' as 'portrait' | 'landscape',
    width: 210,
    height: 297
  });

  // ØªÙƒÙˆÙŠÙ† Ø§Ù„ØªØ§Ø¨Ø§Øª
  const TABS_CONFIG = [
    { id: '960-01', number: '960-01', title: 'Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©', icon: Activity },
    { id: '960-02', number: '960-02', title: 'Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨', icon: Layers },
    { id: '960-03', number: '960-03', title: 'Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬', icon: File },
    { id: '960-04', number: '960-04', title: 'Ù…ØµÙ…Ù… Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨', icon: Layout },
    { id: '960-05', number: '960-05', title: 'Ù…ØµÙ…Ù… Ø§Ù„Ù†Ù…Ø§Ø°Ø¬', icon: Edit },
    { id: '960-06', number: '960-06', title: 'Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØµÙ…ÙŠÙ…', icon: Grid3x3 },
    { id: '960-07', number: '960-07', title: 'Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©', icon: Hash },
    { id: '960-08', number: '960-08', title: 'Ø§Ù„Ø£Ø®ØªØ§Ù… ÙˆØ§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª', icon: Stamp },
    { id: '960-09', number: '960-09', title: 'Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù…ÙŠ', icon: Shield },
    { id: '960-10', number: '960-10', title: 'Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ§Ù„ØªØµØ¯ÙŠØ±', icon: Upload },
    { id: '960-11', number: '960-11', title: 'Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª', icon: GitBranch },
    { id: '960-12', number: '960-12', title: 'Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØ§Ù„ØªØ¬Ù…ÙŠØ¯', icon: Lock },
    { id: '960-13', number: '960-13', title: 'ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…', icon: BarChart3 },
    { id: '960-14', number: '960-14', title: 'Ø§Ù„Ø±Ø¨Ø· Ø¨Ø§Ù„Ø´Ø§Ø´Ø§Øª', icon: Link2 },
    { id: '960-15', number: '960-15', title: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©', icon: Settings },
  ];

  // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© - Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨
  const [templates, setTemplates] = useState<Template[]>([
    {
      id: 'TPL-001',
      code: 'ID-COPY-TPL-001',
      name: 'Ù‚Ø§Ù„Ø¨ ØµÙˆØ±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ©',
      description: 'Ù‚Ø§Ù„Ø¨ Ø±Ø³Ù…ÙŠ Ù„ØªÙˆØ«ÙŠÙ‚ ØµÙˆØ±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ©',
      type: 'template',
      category: 'ÙˆØ«Ø§Ø¦Ù‚ Ø´Ø®ØµÙŠØ©',
      documentNameId: 'DN-001',
      documentNameCode: 'ID-COPY',
      documentName: 'ØµÙˆØ±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ©',
      classificationId: 'CL-001',
      classificationName: 'ÙˆØ«Ø§Ø¦Ù‚ Ø±Ø³Ù…ÙŠØ©',
      width: 210,
      height: 297,
      orientation: 'portrait',
      elements: [],
      variables: [
        { id: 'VAR-001', code: 'OWNER_NAME', name: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ', type: 'text', required: true },
        { id: 'VAR-002', code: 'ID_NUMBER', name: 'Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©', type: 'text', required: true },
        { id: 'VAR-003', code: 'ISSUE_DATE', name: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±', type: 'date', required: true }
      ],
      version: '1.0',
      versionHistory: [
        {
          id: 'V-001',
          version: '1.0',
          description: 'Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£ÙˆÙ„ÙŠ',
          changedBy: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø§Ù„Ù…',
          changedDate: '2025-10-15',
          changes: ['Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ'],
          snapshot: {}
        }
      ],
      isActive: true,
      isFrozen: false,
      usageCount: 456,
      lastUsed: '2025-10-19',
      createdBy: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø§Ù„Ù…',
      createdDate: '2025-10-15',
      permissions: ['view', 'edit', 'delete', 'freeze', 'export'],
      tags: ['ÙˆØ«Ø§Ø¦Ù‚', 'Ù‡ÙˆÙŠØ©', 'Ø±Ø³Ù…ÙŠ']
    },
    {
      id: 'TPL-002',
      code: 'DEED-COPY-TPL-001',
      name: 'Ù‚Ø§Ù„Ø¨ ØµÙˆØ±Ø© Ø§Ù„ØµÙƒ',
      description: 'Ù‚Ø§Ù„Ø¨ Ø±Ø³Ù…ÙŠ Ù„ØªÙˆØ«ÙŠÙ‚ ØµÙˆØ±Ø© Ø§Ù„ØµÙƒ',
      type: 'template',
      category: 'ÙˆØ«Ø§Ø¦Ù‚ Ù…Ù„ÙƒÙŠØ©',
      documentNameId: 'DN-002',
      documentNameCode: 'DEED-COPY',
      documentName: 'ØµÙˆØ±Ø© Ø§Ù„ØµÙƒ',
      classificationId: 'CL-001',
      classificationName: 'ÙˆØ«Ø§Ø¦Ù‚ Ø±Ø³Ù…ÙŠØ©',
      width: 210,
      height: 297,
      orientation: 'portrait',
      elements: [],
      variables: [
        { id: 'VAR-004', code: 'DEED_NUMBER', name: 'Ø±Ù‚Ù… Ø§Ù„ØµÙƒ', type: 'text', required: true },
        { id: 'VAR-005', code: 'AREA', name: 'Ø§Ù„Ù…Ø³Ø§Ø­Ø©', type: 'number', required: true },
        { id: 'VAR-006', code: 'LOCATION', name: 'Ø§Ù„Ù…ÙˆÙ‚Ø¹', type: 'text', required: true }
      ],
      version: '2.1',
      versionHistory: [
        {
          id: 'V-002',
          version: '1.0',
          description: 'Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£ÙˆÙ„ÙŠ',
          changedBy: 'Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ',
          changedDate: '2025-09-20',
          changes: ['Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ'],
          snapshot: {}
        },
        {
          id: 'V-003',
          version: '2.0',
          description: 'Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹',
          changedBy: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯',
          changedDate: '2025-10-05',
          changes: ['Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹', 'ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ†Ø³ÙŠÙ‚'],
          snapshot: {}
        },
        {
          id: 'V-004',
          version: '2.1',
          description: 'ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØµÙ…ÙŠÙ…',
          changedBy: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø³Ø§Ù„Ù…',
          changedDate: '2025-10-18',
          changes: ['ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø®Ø·ÙˆØ·', 'Ø¥Ø¶Ø§ÙØ© Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙƒØªØ¨'],
          snapshot: {}
        }
      ],
      isActive: true,
      isFrozen: true,
      frozenBy: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…',
      frozenDate: '2025-10-18',
      frozenReason: 'Ù…Ø¹ØªÙ…Ø¯ Ø±Ø³Ù…ÙŠØ§Ù‹ - Ù„Ø§ ØªØ¹Ø¯ÙŠÙ„',
      usageCount: 789,
      lastUsed: '2025-10-20',
      createdBy: 'Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ',
      createdDate: '2025-09-20',
      permissions: ['view', 'export'],
      tags: ['ÙˆØ«Ø§Ø¦Ù‚', 'ØµÙƒ', 'Ù…Ù„ÙƒÙŠØ©', 'Ø±Ø³Ù…ÙŠ']
    },
    {
      id: 'FRM-001',
      code: 'ARCH-PLAN-FORM-001',
      name: 'Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠ',
      description: 'Ù†Ù…ÙˆØ°Ø¬ Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©',
      type: 'form',
      category: 'Ù…Ø®Ø·Ø·Ø§Øª Ù‡Ù†Ø¯Ø³ÙŠØ©',
      documentNameId: 'DN-003',
      documentNameCode: 'ARCH-PLAN',
      documentName: 'Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠ',
      classificationId: 'CL-002',
      classificationName: 'ÙˆØ«Ø§Ø¦Ù‚ Ù‡Ù†Ø¯Ø³ÙŠØ©',
      width: 297,
      height: 420,
      orientation: 'landscape',
      elements: [],
      variables: [
        { id: 'VAR-007', code: 'PROJECT_NAME', name: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹', type: 'text', required: true },
        { id: 'VAR-008', code: 'SCALE', name: 'Ø§Ù„Ù…Ù‚ÙŠØ§Ø³', type: 'text', required: true },
        { id: 'VAR-009', code: 'DRAWING_NO', name: 'Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©', type: 'text', required: true }
      ],
      version: '1.5',
      versionHistory: [
        {
          id: 'V-005',
          version: '1.0',
          description: 'Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£ÙˆÙ„ÙŠ',
          changedBy: 'Ù…Ù‡Ù†Ø¯Ø³ ØªØµÙ…ÙŠÙ…',
          changedDate: '2025-08-10',
          changes: ['Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ'],
          snapshot: {}
        },
        {
          id: 'V-006',
          version: '1.5',
          description: 'Ø¥Ø¶Ø§ÙØ© Ø¥Ø·Ø§Ø± Ø§Ù„Ù„ÙˆØ­Ø©',
          changedBy: 'Ù…Ù‡Ù†Ø¯Ø³ ØªØµÙ…ÙŠÙ…',
          changedDate: '2025-10-01',
          changes: ['Ø¥Ø¶Ø§ÙØ© Ø¥Ø·Ø§Ø± Ø§Ù„Ù„ÙˆØ­Ø©', 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø¹Ø§Ø±Ø§Øª'],
          snapshot: {}
        }
      ],
      isActive: true,
      isFrozen: false,
      usageCount: 234,
      lastUsed: '2025-10-20',
      createdBy: 'Ù…Ù‡Ù†Ø¯Ø³ ØªØµÙ…ÙŠÙ…',
      createdDate: '2025-08-10',
      permissions: ['view', 'edit', 'delete', 'export'],
      tags: ['Ù…Ø®Ø·Ø·Ø§Øª', 'Ù…Ø¹Ù…Ø§Ø±ÙŠ', 'Ù‡Ù†Ø¯Ø³ÙŠ']
    }
  ]);

  // Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ØªØ§Ø­Ø©
  const ELEMENT_TYPES = [
    { type: 'text', icon: Type, label: 'Ù†Øµ', color: '#3b82f6' },
    { type: 'image', icon: ImageIcon, label: 'ØµÙˆØ±Ø©', color: '#10b981' },
    { type: 'logo', icon: Building, label: 'Ù„ÙˆØ¬Ùˆ', color: '#f59e0b' },
    { type: 'stamp', icon: Stamp, label: 'Ø®ØªÙ…', color: '#ef4444' },
    { type: 'signature', icon: FileSignature, label: 'ØªÙˆÙ‚ÙŠØ¹', color: '#8b5cf6' },
    { type: 'field', icon: Hash, label: 'Ø­Ù‚Ù„ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ', color: '#06b6d4' },
    { type: 'barcode', icon: Code, label: 'Ø¨Ø§Ø±ÙƒÙˆØ¯', color: '#6b7280' },
    { type: 'qrcode', icon: Grid3x3, label: 'QR ÙƒÙˆØ¯', color: '#6b7280' },
    { type: 'shape', icon: Square, label: 'Ø´ÙƒÙ„', color: '#ec4899' },
    { type: 'digital-auth', icon: Shield, label: 'ØªÙˆØ«ÙŠÙ‚ Ø±Ù‚Ù…ÙŠ', color: '#14b8a6' },
  ];

  // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø­Ø¨ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ±
  const handleDragStart = (e: DragEvent, elementType: string) => {
    setDraggedElementType(elementType);
    setIsDragging(true);
  };

  // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¥ÙÙ„Ø§Øª Ø¹Ù„Ù‰ Canvas
  const handleDrop = (e: DragEvent) => {
    e.preventDefault();
    if (!draggedElementType || !canvasRef.current) return;

    const rect = canvasRef.current.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    const newElement: DesignElement = {
      id: `EL-${Date.now()}`,
      type: draggedElementType as any,
      x,
      y,
      width: 150,
      height: 40,
      content: draggedElementType === 'text' ? 'Ù†Øµ Ø¬Ø¯ÙŠØ¯' : '',
      fontSize: 14,
      fontFamily: 'Tajawal',
      color: '#000000',
      backgroundColor: '#ffffff',
      opacity: 100,
      locked: false,
      layer: designElements.length
    };

    setDesignElements([...designElements, newElement]);
    setSelectedElement(newElement);
    setIsDragging(false);
    setDraggedElementType(null);
  };

  // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø³Ø­Ø¨ ÙÙˆÙ‚ Canvas
  const handleDragOver = (e: DragEvent) => {
    e.preventDefault();
  };

  // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ù„Ø¨/Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯
  const handleCreateTemplate = () => {
    if (!newTemplate.name || !newTemplate.documentNameId || !newTemplate.classificationId) {
      alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
      return;
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø§Ù„ØµÙŠØºØ©: [ÙƒÙˆØ¯ Ø§Ù„Ù…Ø³ØªÙ†Ø¯]-[Ù†ÙˆØ¹]-[Ø±Ù‚Ù… ØªØ³Ù„Ø³Ù„ÙŠ]
    const sequenceNumber = String(templates.filter(t => t.type === newTemplate.type).length + 1).padStart(3, '0');
    const typeCode = newTemplate.type === 'template' ? 'TPL' : 'FORM';
    const code = `${newTemplate.documentNameCode}-${typeCode}-${sequenceNumber}`;

    const template: Template = {
      id: `${newTemplate.type.toUpperCase()}-${Date.now()}`,
      code,
      name: newTemplate.name,
      description: newTemplate.description,
      type: newTemplate.type,
      category: newTemplate.category,
      documentNameId: newTemplate.documentNameId,
      documentNameCode: newTemplate.documentNameCode,
      documentName: newTemplate.documentName,
      classificationId: newTemplate.classificationId,
      classificationName: newTemplate.classificationName,
      width: newTemplate.width,
      height: newTemplate.height,
      orientation: newTemplate.orientation,
      elements: [],
      variables: [],
      version: '1.0',
      versionHistory: [
        {
          id: `V-${Date.now()}`,
          version: '1.0',
          description: 'Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø£ÙˆÙ„ÙŠ',
          changedBy: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ',
          changedDate: new Date().toISOString().split('T')[0],
          changes: ['Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø§Ù„Ø¨/Ø§Ù„Ù†Ù…ÙˆØ°Ø¬'],
          snapshot: {}
        }
      ],
      isActive: true,
      isFrozen: false,
      usageCount: 0,
      createdBy: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ',
      createdDate: new Date().toISOString().split('T')[0],
      permissions: ['view', 'edit', 'delete', 'freeze', 'export', 'duplicate', 'version', 'share'],
      tags: []
    };

    setTemplates([...templates, template]);
    setShowCreateDialog(false);
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    setNewTemplate({
      name: '',
      description: '',
      type: 'template',
      documentNameId: '',
      documentNameCode: '',
      documentName: '',
      classificationId: '',
      classificationName: '',
      category: '',
      orientation: 'portrait',
      width: 210,
      height: 297
    });
  };

  // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯
  const handleDocumentNameChange = (documentNameId: string) => {
    const docName = DOCUMENT_NAMES.find(d => d.id === documentNameId);
    if (docName) {
      setNewTemplate({
        ...newTemplate,
        documentNameId: docName.id,
        documentNameCode: docName.code,
        documentName: docName.name
      });
    }
  };

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØµÙ†ÙŠÙ
  const handleClassificationChange = (classificationId: string) => {
    const classification = CLASSIFICATIONS.find(c => c.id === classificationId);
    if (classification) {
      setNewTemplate({
        ...newTemplate,
        classificationId: classification.id,
        classificationName: classification.name
      });
    }
  };

  // ===== Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„ØªØ§Ø¨Ø§Øª =====

  // ØªØ§Ø¨ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©
  const renderOverviewTab = () => {
    const totalTemplates = templates.filter(t => t.type === 'template').length;
    const totalForms = templates.filter(t => t.type === 'form').length;
    const activeTemplates = templates.filter(t => t.isActive && t.type === 'template').length;
    const frozenTemplates = templates.filter(t => t.isFrozen).length;
    const totalVersions = templates.reduce((sum, t) => sum + t.versionHistory.length, 0);
    const totalUsage = templates.reduce((sum, t) => sum + t.usageCount, 0);

    return (
      <div className="space-y-3">
        {/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */}
        <div className="grid grid-cols-6 gap-2">
          {[
            { label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨', value: totalTemplates, icon: Layers, color: 'blue' },
            { label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬', value: totalForms, icon: File, color: 'green' },
            { label: 'Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù†Ø´Ø·Ø©', value: activeTemplates, icon: CheckCircle, color: 'emerald' },
            { label: 'Ø§Ù„Ù…Ø¬Ù…Ø¯Ø©', value: frozenTemplates, icon: Lock, color: 'red' },
            { label: 'Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª', value: totalVersions, icon: GitBranch, color: 'purple' },
            { label: 'Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙ„ÙŠ', value: totalUsage.toLocaleString('ar-SA'), icon: TrendingUp, color: 'orange' }
          ].map((stat, i) => (
            <Card key={i} className="card-element card-rtl">
              <CardContent className="p-2">
                <div className="flex items-center gap-2 mb-1">
                  {React.createElement(stat.icon, { 
                    className: `h-4 w-4 text-${stat.color}-500 flex-shrink-0` 
                  })}
                  <p className="text-xs text-gray-600 truncate" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                    {stat.label}
                  </p>
                </div>
                <p className="text-lg" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                  {stat.value}
                </p>
              </CardContent>
            </Card>
          ))}
        </div>

        {/* Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Ù‹ */}
        <Card className="card-element card-rtl">
          <CardHeader className="p-3">
            <CardTitle style={{ fontFamily: 'Tajawal, sans-serif' }}>
              <TrendingUp className="h-5 w-5 inline ml-2" />
              Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ ÙˆØ§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Ù‹
            </CardTitle>
          </CardHeader>
          <CardContent className="p-0">
            <Table className="table-rtl">
              <TableHeader>
                <TableRow>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '40px' }}>
                    #
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '120px' }}>
                    Ø§Ù„ÙƒÙˆØ¯
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                    Ø§Ù„Ø§Ø³Ù…
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '100px' }}>
                    Ø§Ù„Ù†ÙˆØ¹
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '120px' }}>
                    Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ø§Øª
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '100px' }}>
                    Ø¢Ø®Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…
                  </TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {[...templates]
                  .sort((a, b) => b.usageCount - a.usageCount)
                  .slice(0, 5)
                  .map((template, index) => (
                    <TableRow key={template.id} className="hover:bg-blue-50/30 transition-colors">
                      <TableCell className="text-right">
                        <Badge variant="outline" className="text-xs">
                          {index + 1}
                        </Badge>
                      </TableCell>
                      <TableCell className="text-right">
                        <Badge variant="outline" className="font-mono text-xs">
                          {template.code}
                        </Badge>
                      </TableCell>
                      <TableCell className="text-right" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                        {template.name}
                      </TableCell>
                      <TableCell className="text-right">
                        <Badge variant="secondary" className="text-xs">
                          {template.type === 'template' ? 'Ù‚Ø§Ù„Ø¨' : 'Ù†Ù…ÙˆØ°Ø¬'}
                        </Badge>
                      </TableCell>
                      <TableCell className="text-right" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                        {template.usageCount.toLocaleString('ar-SA')}
                      </TableCell>
                      <TableCell className="text-right" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                        {template.lastUsed}
                      </TableCell>
                    </TableRow>
                  ))}
              </TableBody>
            </Table>
          </CardContent>
        </Card>

        {/* Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙŠØ¯ */}
        <div className="flex gap-2">
          <Button onClick={() => { setNewTemplate({ ...newTemplate, type: 'template' }); setShowCreateDialog(true); }} style={{ fontFamily: 'Tajawal, sans-serif' }}>
            <Plus className="h-4 w-4 ml-2" />
            Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
          </Button>
          <Button onClick={() => { setNewTemplate({ ...newTemplate, type: 'form' }); setShowCreateDialog(true); }} variant="outline" style={{ fontFamily: 'Tajawal, sans-serif' }}>
            <Plus className="h-4 w-4 ml-2" />
            Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯
          </Button>
        </div>
      </div>
    );
  };

  // ØªØ§Ø¨ Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨
  const renderTemplatesLibraryTab = () => {
    const templatesOnly = templates.filter(t => t.type === 'template');

    return (
      <div className="space-y-3">
        {/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */}
        <div className="grid grid-cols-4 gap-2">
          {[
            { label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨', value: templatesOnly.length, icon: Layers, color: 'blue' },
            { label: 'Ø§Ù„Ù†Ø´Ø·Ø©', value: templatesOnly.filter(t => t.isActive).length, icon: CheckCircle, color: 'green' },
            { label: 'Ø§Ù„Ù…Ø¬Ù…Ø¯Ø©', value: templatesOnly.filter(t => t.isFrozen).length, icon: Lock, color: 'red' },
            { label: 'Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…', value: templatesOnly.reduce((sum, t) => sum + t.usageCount, 0).toLocaleString('ar-SA'), icon: TrendingUp, color: 'purple' }
          ].map((stat, i) => (
            <Card key={i} className="card-element card-rtl">
              <CardContent className="p-2">
                <div className="flex items-center gap-2 mb-1">
                  {React.createElement(stat.icon, { 
                    className: `h-4 w-4 text-${stat.color}-500 flex-shrink-0` 
                  })}
                  <p className="text-xs text-gray-600 truncate" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                    {stat.label}
                  </p>
                </div>
                <p className="text-lg" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                  {typeof stat.value === 'number' ? stat.value : stat.value}
                </p>
              </CardContent>
            </Card>
          ))}
        </div>

        {/* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ */}
        <Card className="card-element card-rtl">
          <CardHeader className="p-3">
            <CardTitle style={{ fontFamily: 'Tajawal, sans-serif' }}>
              Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ ({templatesOnly.length})
            </CardTitle>
          </CardHeader>
          <CardContent className="p-0">
            <Table className="table-rtl">
              <TableHeader>
                <TableRow>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '120px' }}>
                    Ø§Ù„ÙƒÙˆØ¯
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                    Ø§Ù„Ø§Ø³Ù…
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                    Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                    Ø§Ù„ØªØµÙ†ÙŠÙ
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '80px' }}>
                    Ø§Ù„Ø¥ØµØ¯Ø§Ø±
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '80px' }}>
                    Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '80px' }}>
                    Ø§Ù„Ø­Ø§Ù„Ø©
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '160px' }}>
                    Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
                  </TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {templatesOnly.map((template) => (
                  <TableRow key={template.id} className="hover:bg-blue-50/30 transition-colors">
                    <TableCell className="text-right">
                      <Badge variant="outline" className="font-mono text-xs">
                        {template.code}
                      </Badge>
                    </TableCell>
                    <TableCell className="text-right" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                      {template.name}
                    </TableCell>
                    <TableCell className="text-right">
                      <Badge variant="outline" className="text-xs">
                        {template.documentName}
                      </Badge>
                    </TableCell>
                    <TableCell className="text-right">
                      <Badge variant="secondary" className="text-xs">
                        {template.classificationName}
                      </Badge>
                    </TableCell>
                    <TableCell className="text-right">
                      <Badge variant="outline" className="font-mono text-xs">
                        {template.version}
                      </Badge>
                    </TableCell>
                    <TableCell className="text-right" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                      {template.usageCount.toLocaleString('ar-SA')}
                    </TableCell>
                    <TableCell className="text-right">
                      {template.isFrozen ? (
                        <Badge className="bg-red-500 text-white text-xs">
                          <Lock className="h-3 w-3 ml-1" />
                          Ù…Ø¬Ù…Ø¯
                        </Badge>
                      ) : template.isActive ? (
                        <Badge className="bg-green-500 text-white text-xs">
                          <CheckCircle className="h-3 w-3 ml-1" />
                          Ù†Ø´Ø·
                        </Badge>
                      ) : (
                        <Badge className="bg-gray-400 text-white text-xs">ØºÙŠØ± Ù†Ø´Ø·</Badge>
                      )}
                    </TableCell>
                    <TableCell className="text-right">
                      <div className="flex gap-1 justify-end">
                        <Button size="sm" variant="ghost" className="h-7 w-7 p-0">
                          <Eye className="h-3.5 w-3.5" />
                        </Button>
                        <Button size="sm" variant="ghost" className="h-7 w-7 p-0" disabled={template.isFrozen}>
                          <Edit className="h-3.5 w-3.5" />
                        </Button>
                        <Button size="sm" variant="ghost" className="h-7 w-7 p-0">
                          <Copy className="h-3.5 w-3.5" />
                        </Button>
                        <Button size="sm" variant="ghost" className="h-7 w-7 p-0">
                          <Download className="h-3.5 w-3.5" />
                        </Button>
                        <Button size="sm" variant="ghost" className="h-7 w-7 p-0 text-red-600" disabled={template.isFrozen}>
                          <Trash2 className="h-3.5 w-3.5" />
                        </Button>
                      </div>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </CardContent>
        </Card>

        {/* Ø²Ø± Ø¥Ø¶Ø§ÙØ© */}
        <div className="flex justify-end">
          <Button onClick={() => { setNewTemplate({ ...newTemplate, type: 'template' }); setShowCreateDialog(true); }} style={{ fontFamily: 'Tajawal, sans-serif' }}>
            <Plus className="h-4 w-4 ml-2" />
            Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
          </Button>
        </div>
      </div>
    );
  };

  // ØªØ§Ø¨ Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
  const renderFormsLibraryTab = () => {
    const formsOnly = templates.filter(t => t.type === 'form');

    return (
      <div className="space-y-3">
        {/* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */}
        <div className="grid grid-cols-4 gap-2">
          {[
            { label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬', value: formsOnly.length, icon: File, color: 'green' },
            { label: 'Ø§Ù„Ù†Ø´Ø·Ø©', value: formsOnly.filter(t => t.isActive).length, icon: CheckCircle, color: 'emerald' },
            { label: 'Ø§Ù„Ù…Ø¬Ù…Ø¯Ø©', value: formsOnly.filter(t => t.isFrozen).length, icon: Lock, color: 'red' },
            { label: 'Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…', value: formsOnly.reduce((sum, t) => sum + t.usageCount, 0).toLocaleString('ar-SA'), icon: TrendingUp, color: 'purple' }
          ].map((stat, i) => (
            <Card key={i} className="card-element card-rtl">
              <CardContent className="p-2">
                <div className="flex items-center gap-2 mb-1">
                  {React.createElement(stat.icon, { 
                    className: `h-4 w-4 text-${stat.color}-500 flex-shrink-0` 
                  })}
                  <p className="text-xs text-gray-600 truncate" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                    {stat.label}
                  </p>
                </div>
                <p className="text-lg" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                  {typeof stat.value === 'number' ? stat.value : stat.value}
                </p>
              </CardContent>
            </Card>
          ))}
        </div>

        {/* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ */}
        <Card className="card-element card-rtl">
          <CardHeader className="p-3">
            <CardTitle style={{ fontFamily: 'Tajawal, sans-serif' }}>
              Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ({formsOnly.length})
            </CardTitle>
          </CardHeader>
          <CardContent className="p-0">
            <Table className="table-rtl">
              <TableHeader>
                <TableRow>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '120px' }}>
                    Ø§Ù„ÙƒÙˆØ¯
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                    Ø§Ù„Ø§Ø³Ù…
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                    Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                    Ø§Ù„ØªØµÙ†ÙŠÙ
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '80px' }}>
                    Ø§Ù„Ø¥ØµØ¯Ø§Ø±
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '80px' }}>
                    Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '80px' }}>
                    Ø§Ù„Ø­Ø§Ù„Ø©
                  </TableHead>
                  <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '160px' }}>
                    Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
                  </TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {formsOnly.map((form) => (
                  <TableRow key={form.id} className="hover:bg-blue-50/30 transition-colors">
                    <TableCell className="text-right">
                      <Badge variant="outline" className="font-mono text-xs">
                        {form.code}
                      </Badge>
                    </TableCell>
                    <TableCell className="text-right" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                      {form.name}
                    </TableCell>
                    <TableCell className="text-right">
                      <Badge variant="outline" className="text-xs">
                        {form.documentName}
                      </Badge>
                    </TableCell>
                    <TableCell className="text-right">
                      <Badge variant="secondary" className="text-xs">
                        {form.classificationName}
                      </Badge>
                    </TableCell>
                    <TableCell className="text-right">
                      <Badge variant="outline" className="font-mono text-xs">
                        {form.version}
                      </Badge>
                    </TableCell>
                    <TableCell className="text-right" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                      {form.usageCount.toLocaleString('ar-SA')}
                    </TableCell>
                    <TableCell className="text-right">
                      {form.isFrozen ? (
                        <Badge className="bg-red-500 text-white text-xs">
                          <Lock className="h-3 w-3 ml-1" />
                          Ù…Ø¬Ù…Ø¯
                        </Badge>
                      ) : form.isActive ? (
                        <Badge className="bg-green-500 text-white text-xs">
                          <CheckCircle className="h-3 w-3 ml-1" />
                          Ù†Ø´Ø·
                        </Badge>
                      ) : (
                        <Badge className="bg-gray-400 text-white text-xs">ØºÙŠØ± Ù†Ø´Ø·</Badge>
                      )}
                    </TableCell>
                    <TableCell className="text-right">
                      <div className="flex gap-1 justify-end">
                        <Button size="sm" variant="ghost" className="h-7 w-7 p-0">
                          <Eye className="h-3.5 w-3.5" />
                        </Button>
                        <Button size="sm" variant="ghost" className="h-7 w-7 p-0" disabled={form.isFrozen}>
                          <Edit className="h-3.5 w-3.5" />
                        </Button>
                        <Button size="sm" variant="ghost" className="h-7 w-7 p-0">
                          <Copy className="h-3.5 w-3.5" />
                        </Button>
                        <Button size="sm" variant="ghost" className="h-7 w-7 p-0">
                          <Download className="h-3.5 w-3.5" />
                        </Button>
                        <Button size="sm" variant="ghost" className="h-7 w-7 p-0 text-red-600" disabled={form.isFrozen}>
                          <Trash2 className="h-3.5 w-3.5" />
                        </Button>
                      </div>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </CardContent>
        </Card>

        {/* Ø²Ø± Ø¥Ø¶Ø§ÙØ© */}
        <div className="flex justify-end">
          <Button onClick={() => { setNewTemplate({ ...newTemplate, type: 'form' }); setShowCreateDialog(true); }} style={{ fontFamily: 'Tajawal, sans-serif' }}>
            <Plus className="h-4 w-4 ml-2" />
            Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯
          </Button>
        </div>
      </div>
    );
  };

  // ØªØ§Ø¨ Ø§Ù„Ù…ØµÙ…Ù… (Drag & Drop)
  const renderDesignerTab = () => (
    <div className="space-y-3">
      {/* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª */}
      <Card className="card-element card-rtl">
        <CardContent className="p-2">
          <div className="flex items-center justify-between gap-2">
            {/* Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­Ø±ÙŠØ± */}
            <div className="flex gap-1">
              <Button size="sm" variant="outline">
                <Save className="h-4 w-4 ml-1" />
                Ø­ÙØ¸
              </Button>
              <Button size="sm" variant="outline">
                <Eye className="h-4 w-4 ml-1" />
                Ù…Ø¹Ø§ÙŠÙ†Ø©
              </Button>
              <Separator orientation="vertical" className="h-6" />
              <Button size="sm" variant="ghost" className="h-8 w-8 p-0">
                <AlignRight className="h-4 w-4" />
              </Button>
              <Button size="sm" variant="ghost" className="h-8 w-8 p-0">
                <AlignCenter className="h-4 w-4" />
              </Button>
              <Button size="sm" variant="ghost" className="h-8 w-8 p-0">
                <AlignLeft className="h-4 w-4" />
              </Button>
            </div>

            {/* Ø§Ù„ØªÙƒØ¨ÙŠØ±/Ø§Ù„ØªØµØºÙŠØ± */}
            <div className="flex items-center gap-2">
              <Button size="sm" variant="ghost" className="h-8 w-8 p-0" onClick={() => setCanvasZoom(Math.max(25, canvasZoom - 10))}>
                <ZoomOut className="h-4 w-4" />
              </Button>
              <span className="text-sm" style={{ fontFamily: 'Tajawal, sans-serif', minWidth: '50px', textAlign: 'center' }}>
                {canvasZoom}%
              </span>
              <Button size="sm" variant="ghost" className="h-8 w-8 p-0" onClick={() => setCanvasZoom(Math.min(200, canvasZoom + 10))}>
                <ZoomIn className="h-4 w-4" />
              </Button>
              <Separator orientation="vertical" className="h-6" />
              <div className="flex items-center gap-2">
                <EnhancedSwitch
                  id="show-grid"
                  checked={showGrid}
                  onCheckedChange={setShowGrid}
                  size="sm"
                />
                <span className="text-sm" style={{ fontFamily: 'Tajawal, sans-serif' }}>Ø´Ø¨ÙƒØ©</span>
              </div>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */}
      <div className="grid grid-cols-12 gap-3">
        {/* Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */}
        <Card className="col-span-2 card-element card-rtl">
          <CardHeader className="p-2">
            <CardTitle className="text-sm" style={{ fontFamily: 'Tajawal, sans-serif' }}>
              Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØµÙ…ÙŠÙ…
            </CardTitle>
          </CardHeader>
          <CardContent className="p-2">
            <ScrollArea className="h-[500px]">
              <div className="space-y-1">
                {ELEMENT_TYPES.map((element) => (
                  <div
                    key={element.type}
                    draggable
                    onDragStart={(e) => handleDragStart(e, element.type)}
                    className="p-2 border rounded cursor-move hover:bg-blue-50 transition-colors"
                    style={{ borderColor: element.color }}
                  >
                    <div className="flex items-center gap-2">
                      {React.createElement(element.icon, { 
                        className: 'h-4 w-4',
                        style: { color: element.color }
                      })}
                      <span className="text-xs" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                        {element.label}
                      </span>
                    </div>
                  </div>
                ))}
              </div>
            </ScrollArea>
          </CardContent>
        </Card>

        {/* Canvas Ø§Ù„ØªØµÙ…ÙŠÙ… */}
        <Card className="col-span-7 card-element card-rtl">
          <CardContent className="p-3">
            <div
              ref={canvasRef}
              onDrop={handleDrop}
              onDragOver={handleDragOver}
              className="relative border-2 border-dashed border-gray-300 bg-white"
              style={{
                width: '100%',
                height: '600px',
                backgroundImage: showGrid ? 'linear-gradient(#e5e7eb 1px, transparent 1px), linear-gradient(90deg, #e5e7eb 1px, transparent 1px)' : 'none',
                backgroundSize: showGrid ? '20px 20px' : 'auto',
                transform: `scale(${canvasZoom / 100})`,
                transformOrigin: 'top right',
                overflow: 'auto'
              }}
            >
              {designElements.map((element) => (
                <div
                  key={element.id}
                  className={`absolute border ${selectedElement?.id === element.id ? 'border-blue-500 border-2' : 'border-gray-300'}`}
                  style={{
                    left: element.x,
                    top: element.y,
                    width: element.width,
                    height: element.height,
                    backgroundColor: element.backgroundColor,
                    opacity: (element.opacity || 100) / 100,
                    cursor: element.locked ? 'not-allowed' : 'move',
                    transform: `rotate(${element.rotation || 0}deg)`
                  }}
                  onClick={() => setSelectedElement(element)}
                >
                  {element.type === 'text' && (
                    <div
                      className="p-1"
                      style={{
                        fontFamily: element.fontFamily || 'Tajawal',
                        fontSize: element.fontSize || 14,
                        color: element.color || '#000000',
                        textAlign: (element.textAlign as any) || 'right',
                        direction: 'rtl'
                      }}
                    >
                      {element.content || 'Ù†Øµ Ø¬Ø¯ÙŠØ¯'}
                    </div>
                  )}
                  {element.type === 'digital-auth' && (
                    <div className="flex items-center justify-center h-full bg-teal-50 border-2 border-dashed border-teal-300">
                      <div className="text-center">
                        <Shield className="h-8 w-8 mx-auto mb-1 text-teal-600" />
                        <p className="text-xs text-teal-700" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                          Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù…ÙŠ
                        </p>
                      </div>
                    </div>
                  )}
                  {element.type === 'stamp' && (
                    <div className="flex items-center justify-center h-full">
                      <Stamp className="h-12 w-12 text-red-600" />
                    </div>
                  )}
                  {element.type === 'signature' && (
                    <div className="flex items-center justify-center h-full border-b-2 border-gray-400">
                      <FileSignature className="h-8 w-8 text-purple-600" />
                    </div>
                  )}
                </div>
              ))}

              {designElements.length === 0 && !isDragging && (
                <div className="absolute inset-0 flex items-center justify-center text-gray-400">
                  <div className="text-center">
                    <Move className="h-12 w-12 mx-auto mb-2" />
                    <p style={{ fontFamily: 'Tajawal, sans-serif' }}>
                      Ø§Ø³Ø­Ø¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ÙˆØ£ÙÙ„ØªÙ‡Ø§ Ù‡Ù†Ø§
                    </p>
                  </div>
                </div>
              )}
            </div>
          </CardContent>
        </Card>

        {/* Ù„ÙˆØ­Ø© Ø§Ù„Ø®ØµØ§Ø¦Øµ */}
        <Card className="col-span-3 card-element card-rtl">
          <CardHeader className="p-2">
            <CardTitle className="text-sm" style={{ fontFamily: 'Tajawal, sans-serif' }}>
              Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø¹Ù†ØµØ±
            </CardTitle>
          </CardHeader>
          <CardContent className="p-2">
            {selectedElement ? (
              <ScrollArea className="h-[500px]">
                <div className="space-y-3">
                  <div>
                    <p className="text-xs mb-1" style={{ fontFamily: 'Tajawal, sans-serif', color: '#2563eb', fontWeight: 700 }}>
                      Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù†ØµØ±
                    </p>
                    <Badge variant="secondary">
                      {ELEMENT_TYPES.find(e => e.type === selectedElement.type)?.label}
                    </Badge>
                  </div>

                  <Separator />

                  <div>
                    <p className="text-xs mb-2" style={{ fontFamily: 'Tajawal, sans-serif', color: '#2563eb', fontWeight: 700 }}>
                      Ø§Ù„Ù…ÙˆØ¶Ø¹ ÙˆØ§Ù„Ø­Ø¬Ù…
                    </p>
                    <div className="grid grid-cols-2 gap-2">
                      <InputWithCopy
                        label="X"
                        id="element-x"
                        type="number"
                        value={selectedElement.x.toString()}
                        onChange={(e) => setSelectedElement({ ...selectedElement, x: parseInt(e.target.value) || 0 })}
                        copyable={false}
                        clearable={false}
                      />
                      <InputWithCopy
                        label="Y"
                        id="element-y"
                        type="number"
                        value={selectedElement.y.toString()}
                        onChange={(e) => setSelectedElement({ ...selectedElement, y: parseInt(e.target.value) || 0 })}
                        copyable={false}
                        clearable={false}
                      />
                      <InputWithCopy
                        label="Ø§Ù„Ø¹Ø±Ø¶"
                        id="element-width"
                        type="number"
                        value={selectedElement.width.toString()}
                        onChange={(e) => setSelectedElement({ ...selectedElement, width: parseInt(e.target.value) || 0 })}
                        copyable={false}
                        clearable={false}
                      />
                      <InputWithCopy
                        label="Ø§Ù„Ø§Ø±ØªÙØ§Ø¹"
                        id="element-height"
                        type="number"
                        value={selectedElement.height.toString()}
                        onChange={(e) => setSelectedElement({ ...selectedElement, height: parseInt(e.target.value) || 0 })}
                        copyable={false}
                        clearable={false}
                      />
                    </div>
                  </div>

                  {selectedElement.type === 'text' && (
                    <>
                      <Separator />
                      <div>
                        <InputWithCopy
                          label="Ø§Ù„Ù…Ø­ØªÙˆÙ‰"
                          id="element-content"
                          value={selectedElement.content || ''}
                          onChange={(e) => setSelectedElement({ ...selectedElement, content: e.target.value })}
                          copyable={true}
                          clearable={true}
                        />
                      </div>
                      <div>
                        <InputWithCopy
                          label="Ø­Ø¬Ù… Ø§Ù„Ø®Ø·"
                          id="element-fontsize"
                          type="number"
                          value={(selectedElement.fontSize || 14).toString()}
                          onChange={(e) => setSelectedElement({ ...selectedElement, fontSize: parseInt(e.target.value) || 14 })}
                          copyable={false}
                          clearable={false}
                        />
                      </div>
                    </>
                  )}

                  <Separator />

                  <div>
                    <p className="text-xs mb-2" style={{ fontFamily: 'Tajawal, sans-serif', color: '#2563eb', fontWeight: 700 }}>
                      Ø§Ù„Ø£Ù„ÙˆØ§Ù†
                    </p>
                    <div className="space-y-2">
                      <div>
                        <label className="text-xs" style={{ fontFamily: 'Tajawal, sans-serif' }}>Ù„ÙˆÙ† Ø§Ù„Ù†Øµ</label>
                        <input
                          type="color"
                          value={selectedElement.color || '#000000'}
                          onChange={(e) => setSelectedElement({ ...selectedElement, color: e.target.value })}
                          className="w-full h-8 rounded border"
                        />
                      </div>
                      <div>
                        <label className="text-xs" style={{ fontFamily: 'Tajawal, sans-serif' }}>Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©</label>
                        <input
                          type="color"
                          value={selectedElement.backgroundColor || '#ffffff'}
                          onChange={(e) => setSelectedElement({ ...selectedElement, backgroundColor: e.target.value })}
                          className="w-full h-8 rounded border"
                        />
                      </div>
                    </div>
                  </div>

                  <Separator />

                  <div>
                    <div className="flex items-center justify-between mb-2">
                      <p className="text-xs" style={{ fontFamily: 'Tajawal, sans-serif', color: '#2563eb', fontWeight: 700 }}>
                        Ù‚ÙÙ„ Ø§Ù„Ø¹Ù†ØµØ±
                      </p>
                      <EnhancedSwitch
                        id="element-locked"
                        checked={selectedElement.locked || false}
                        onCheckedChange={(checked) => setSelectedElement({ ...selectedElement, locked: checked })}
                        size="sm"
                      />
                    </div>
                  </div>

                  <Separator />

                  <Button
                    variant="destructive"
                    size="sm"
                    className="w-full"
                    onClick={() => {
                      setDesignElements(designElements.filter(e => e.id !== selectedElement.id));
                      setSelectedElement(null);
                    }}
                  >
                    <Trash2 className="h-4 w-4 ml-2" />
                    Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ±
                  </Button>
                </div>
              </ScrollArea>
            ) : (
              <div className="h-[500px] flex items-center justify-center text-gray-400 text-center">
                <div>
                  <Info className="h-12 w-12 mx-auto mb-2" />
                  <p className="text-sm" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                    Ø§Ø®ØªØ± Ø¹Ù†ØµØ±Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø®ØµØ§Ø¦ØµÙ‡
                  </p>
                </div>
              </div>
            )}
          </CardContent>
        </Card>
      </div>
    </div>
  );

  // ØªØ§Ø¨ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØµÙ…ÙŠÙ…
  const renderDesignElementsTab = () => (
    <div className="space-y-3">
      <Card className="card-element card-rtl">
        <CardHeader className="p-3">
          <CardTitle style={{ fontFamily: 'Tajawal, sans-serif' }}>
            Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ØªØ§Ø­Ø©
          </CardTitle>
        </CardHeader>
        <CardContent className="p-3">
          <div className="grid grid-cols-5 gap-3">
            {ELEMENT_TYPES.map((element) => (
              <Card key={element.type} className="card-element card-rtl hover:shadow-md transition-shadow">
                <CardContent className="p-3">
                  <div className="text-center">
                    <div
                      className="w-16 h-16 mx-auto mb-2 rounded-full flex items-center justify-center"
                      style={{ backgroundColor: `${element.color}20` }}
                    >
                      {React.createElement(element.icon, { 
                        className: 'h-8 w-8',
                        style: { color: element.color }
                      })}
                    </div>
                    <p className="text-sm" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                      {element.label}
                    </p>
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>
        </CardContent>
      </Card>

      <Card className="card-element card-rtl">
        <CardHeader className="p-3">
          <CardTitle style={{ fontFamily: 'Tajawal, sans-serif' }}>
            ÙˆØµÙ Ø§Ù„Ø¹Ù†Ø§ØµØ±
          </CardTitle>
        </CardHeader>
        <CardContent className="p-3">
          <div className="space-y-2">
            {ELEMENT_TYPES.map((element) => (
              <div key={element.type} className="flex items-start gap-3 p-2 rounded hover:bg-gray-50">
                {React.createElement(element.icon, { 
                  className: 'h-5 w-5 mt-0.5 flex-shrink-0',
                  style: { color: element.color }
                })}
                <div className="flex-1">
                  <p className="text-sm" style={{ fontFamily: 'Tajawal, sans-serif', fontWeight: 600 }}>
                    {element.label}
                  </p>
                  <p className="text-xs text-gray-600" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                    {element.type === 'text' && 'Ù†ØµÙˆØµ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„'}
                    {element.type === 'image' && 'Ø±ÙØ¹ ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙˆØ±'}
                    {element.type === 'logo' && 'Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙƒØªØ¨ ÙˆØ§Ù„Ø¬Ù‡Ø§Øª'}
                    {element.type === 'stamp' && 'Ø£Ø®ØªØ§Ù… Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©'}
                    {element.type === 'signature' && 'ØªÙˆÙ‚ÙŠØ¹Ø§Øª Ø±Ù‚Ù…ÙŠØ© ÙˆØ¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©'}
                    {element.type === 'field' && 'Ø­Ù‚ÙˆÙ„ Ù…ØªØºÙŠØ±Ø© ØªÙ…Ù„Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹'}
                    {element.type === 'barcode' && 'Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©'}
                    {element.type === 'qrcode' && 'Ø±Ù…Ø² QR Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©'}
                    {element.type === 'shape' && 'Ø£Ø´ÙƒØ§Ù„ Ù‡Ù†Ø¯Ø³ÙŠØ© Ù…ØªÙ†ÙˆØ¹Ø©'}
                    {element.type === 'digital-auth' && 'Ù…Ù†Ø·Ù‚Ø© Ù…Ø­Ø¬ÙˆØ²Ø© Ù„Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù…ÙŠ'}
                  </p>
                </div>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    </div>
  );

  // ØªØ§Ø¨ Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª
  const renderVersionsTab = () => (
    <div className="space-y-3">
      <Card className="card-element card-rtl">
        <CardHeader className="p-3">
          <CardTitle style={{ fontFamily: 'Tajawal, sans-serif' }}>
            <GitBranch className="h-5 w-5 inline ml-2" />
            Ø³Ø¬Ù„ Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø§Øª
          </CardTitle>
        </CardHeader>
        <CardContent className="p-0">
          <Table className="table-rtl">
            <TableHeader>
              <TableRow>
                <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '100px' }}>
                  Ø§Ù„Ø¥ØµØ¯Ø§Ø±
                </TableHead>
                <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                  Ø§Ù„ÙˆØµÙ
                </TableHead>
                <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '120px' }}>
                  Ø¨ÙˆØ§Ø³Ø·Ø©
                </TableHead>
                <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '100px' }}>
                  Ø§Ù„ØªØ§Ø±ÙŠØ®
                </TableHead>
                <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '80px' }}>
                  Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                </TableHead>
                <TableHead className="text-right" style={{ fontFamily: 'Tajawal, sans-serif', width: '140px' }}>
                  Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
                </TableHead>
              </TableRow>
            </TableHeader>
            <TableBody>
              {templates
                .flatMap(t => t.versionHistory.map(v => ({ ...v, templateCode: t.code, templateName: t.name })))
                .sort((a, b) => new Date(b.changedDate).getTime() - new Date(a.changedDate).getTime())
                .slice(0, 10)
                .map((version: any) => (
                  <TableRow key={version.id} className="hover:bg-blue-50/30 transition-colors">
                    <TableCell className="text-right">
                      <Badge variant="outline" className="font-mono text-xs">
                        {version.version}
                      </Badge>
                    </TableCell>
                    <TableCell className="text-right">
                      <div>
                        <p className="text-sm" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                          {version.description}
                        </p>
                        <p className="text-xs text-gray-500" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                          {version.templateName}
                        </p>
                      </div>
                    </TableCell>
                    <TableCell className="text-right" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                      {version.changedBy}
                    </TableCell>
                    <TableCell className="text-right" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                      {version.changedDate}
                    </TableCell>
                    <TableCell className="text-right">
                      <Badge variant="secondary" className="text-xs">
                        {version.changes.length}
                      </Badge>
                    </TableCell>
                    <TableCell className="text-right">
                      <div className="flex gap-1 justify-end">
                        <Button size="sm" variant="ghost" className="h-7 w-7 p-0">
                          <Eye className="h-3.5 w-3.5" />
                        </Button>
                        <Button size="sm" variant="ghost" className="h-7 w-7 p-0">
                          <RotateCw className="h-3.5 w-3.5" />
                        </Button>
                      </div>
                    </TableCell>
                  </TableRow>
                ))}
            </TableBody>
          </Table>
        </CardContent>
      </Card>
    </div>
  );

  // ØªØ§Ø¨ Ø§Ù„Ø±Ø¨Ø· Ø¨Ø§Ù„Ø´Ø§Ø´Ø§Øª
  const renderIntegrationTab = () => (
    <div className="space-y-3">
      <Card className="card-element card-rtl">
        <CardHeader className="p-3">
          <CardTitle style={{ fontFamily: 'Tajawal, sans-serif' }}>
            <Link2 className="h-5 w-5 inline ml-2" />
            Ø§Ù„Ø±Ø¨Ø· Ø¨Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
          </CardTitle>
        </CardHeader>
        <CardContent className="p-3">
          <div className="space-y-3">
            {/* Ø´Ø§Ø´Ø© 942 */}
            <Card className="card-element card-rtl hover:shadow-md transition-shadow">
              <CardContent className="p-3">
                <div className="flex items-start gap-3">
                  <div className="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0">
                    <FileText className="h-6 w-6 text-blue-600" />
                  </div>
                  <div className="flex-1">
                    <h3 className="text-sm mb-1" style={{ fontFamily: 'Tajawal, sans-serif', fontWeight: 700 }}>
                      Ø´Ø§Ø´Ø© 942 - Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª
                    </h3>
                    <p className="text-xs text-gray-600 mb-2" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                      Ø±Ø¨Ø· Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ ÙˆØ§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø¨Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙØ© ÙÙŠ Ø§Ù„ØªØ§Ø¨ 942-13
                    </p>
                    <Badge variant="secondary" className="text-xs">
                      {DOCUMENT_NAMES.length} Ø§Ø³Ù… Ù…Ø³ØªÙ†Ø¯ Ù…ØªØ§Ø­
                    </Badge>
                  </div>
                  <Button size="sm" variant="outline">
                    <Link2 className="h-4 w-4 ml-2" />
                    Ø¹Ø±Ø¶
                  </Button>
                </div>
              </CardContent>
            </Card>

            {/* Ø´Ø§Ø´Ø© 701 */}
            <Card className="card-element card-rtl hover:shadow-md transition-shadow">
              <CardContent className="p-3">
                <div className="flex items-start gap-3">
                  <div className="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0">
                    <Tag className="h-6 w-6 text-green-600" />
                  </div>
                  <div className="flex-1">
                    <h3 className="text-sm mb-1" style={{ fontFamily: 'Tajawal, sans-serif', fontWeight: 700 }}>
                      Ø´Ø§Ø´Ø© 701 - Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª
                    </h3>
                    <p className="text-xs text-gray-600 mb-2" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                      Ø±Ø¨Ø· Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ ÙˆØ§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø¨Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ù…Ø¹Ø±ÙØ© ÙÙŠ Ø§Ù„ØªØ§Ø¨ 701-06 Ùˆ 701-11
                    </p>
                    <Badge variant="secondary" className="text-xs">
                      {CLASSIFICATIONS.length} ØªØµÙ†ÙŠÙ Ù…ØªØ§Ø­
                    </Badge>
                  </div>
                  <Button size="sm" variant="outline">
                    <Link2 className="h-4 w-4 ml-2" />
                    Ø¹Ø±Ø¶
                  </Button>
                </div>
              </CardContent>
            </Card>

            {/* Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Øª (Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹) */}
            <Card className="card-element card-rtl hover:shadow-md transition-shadow opacity-60">
              <CardContent className="p-3">
                <div className="flex items-start gap-3">
                  <div className="w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center flex-shrink-0">
                    <DollarSign className="h-6 w-6 text-orange-600" />
                  </div>
                  <div className="flex-1">
                    <h3 className="text-sm mb-1" style={{ fontFamily: 'Tajawal, sans-serif', fontWeight: 700 }}>
                      Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Øª
                    </h3>
                    <p className="text-xs text-gray-600 mb-2" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                      Ø±Ø¨Ø· Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø¨Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© (Ù‚Ø±ÙŠØ¨Ø§Ù‹)
                    </p>
                    <Badge variant="outline" className="text-xs">
                      Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±
                    </Badge>
                  </div>
                  <Button size="sm" variant="outline" disabled>
                    <Clock className="h-4 w-4 ml-2" />
                    Ù‚Ø±ÙŠØ¨Ø§Ù‹
                  </Button>
                </div>
              </CardContent>
            </Card>
          </div>
        </CardContent>
      </Card>

      {/* Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */}
      <Card className="card-element card-rtl bg-blue-50">
        <CardContent className="p-3">
          <div className="flex items-start gap-3">
            <Info className="h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5" />
            <div>
              <h4 className="text-sm mb-1" style={{ fontFamily: 'Tajawal, sans-serif', fontWeight: 700 }}>
                Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø©
              </h4>
              <p className="text-xs text-gray-700" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ ÙˆØ§Ù„Ù†Ù…Ø§Ø°Ø¬ ÙŠØ¬Ø¨ Ø£Ù† ØªØ±ØªØ¨Ø· Ø¨Ù€:
              </p>
              <ul className="text-xs text-gray-700 mr-4 mt-1 space-y-1" style={{ fontFamily: 'Tajawal, sans-serif' }}>
                <li>â€¢ <strong>Ø§Ø³Ù… Ù…Ø³ØªÙ†Ø¯</strong> Ù…Ù† Ø´Ø§Ø´Ø© 942 (Ø¥Ù„Ø²Ø§Ù…ÙŠ)</li>
                <li>â€¢ <strong>ØªØµÙ†ÙŠÙ</strong> Ù…Ù† Ø´Ø§Ø´Ø© 701 (Ø¥Ù„Ø²Ø§Ù…ÙŠ)</li>
                <li>â€¢ <strong>Ø¹Ù…Ù„Ø©</strong> Ù„Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø§Ù„ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ - Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹)</li>
              </ul>
            </div>
          </div>
        </CardContent>
      </Card>
    </div>
  );

  // Ø±Ù†Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ§Ø¨
  const renderTabContent = () => {
    switch (activeTab) {
      case '960-01':
        return renderOverviewTab();
      case '960-02':
        return renderTemplatesLibraryTab();
      case '960-03':
        return renderFormsLibraryTab();
      case '960-04':
      case '960-05':
        return renderDesignerTab();
      case '960-06':
        return renderDesignElementsTab();
      case '960-07':
        return <div className="p-4 text-center text-gray-500" style={{ fontFamily: 'Tajawal, sans-serif' }}>Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© (Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±)</div>;
      case '960-08':
        return <div className="p-4 text-center text-gray-500" style={{ fontFamily: 'Tajawal, sans-serif' }}>Ø§Ù„Ø£Ø®ØªØ§Ù… ÙˆØ§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª (Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±)</div>;
      case '960-09':
        return <div className="p-4 text-center text-gray-500" style={{ fontFamily: 'Tajawal, sans-serif' }}>Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø±Ù‚Ù…ÙŠ (Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±)</div>;
      case '960-10':
        return <div className="p-4 text-center text-gray-500" style={{ fontFamily: 'Tajawal, sans-serif' }}>Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ§Ù„ØªØµØ¯ÙŠØ± (Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±)</div>;
      case '960-11':
        return renderVersionsTab();
      case '960-12':
        return <div className="p-4 text-center text-gray-500" style={{ fontFamily: 'Tajawal, sans-serif' }}>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ÙˆØ§Ù„ØªØ¬Ù…ÙŠØ¯ (Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±)</div>;
      case '960-13':
        return <div className="p-4 text-center text-gray-500" style={{ fontFamily: 'Tajawal, sans-serif' }}>ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… (Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±)</div>;
      case '960-14':
        return renderIntegrationTab();
      case '960-15':
        return <div className="p-4 text-center text-gray-500" style={{ fontFamily: 'Tajawal, sans-serif' }}>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© (Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±)</div>;
      default:
        return renderOverviewTab();
    }
  };

  return (
    <div className="flex" style={{ direction: 'rtl', gap: '1rem', minHeight: 'calc(100vh - 140px)' }}>
      {/* Ø§Ù„Ø³Ø§ÙŠØ¯ Ø¨Ø§Ø± Ø§Ù„Ù…ÙˆØ­Ø¯ Ù„Ù„ØªØ§Ø¨Ø§Øª */}
      <div
        style={{
          width: '200px',
          minWidth: '200px',
          height: 'calc(100vh - 140px)',
          position: 'sticky',
          top: '70px',
          right: 0,
          background: 'linear-gradient(to bottom, #f8fafc, #f1f5f9)',
          borderLeft: '2px solid #e2e8f0',
          borderRadius: '12px 0 0 12px',
          boxShadow: '-2px 0 8px rgba(0, 0, 0, 0.05)'
        }}
      >
        <ScrollArea 
          className="h-full" 
          style={{
            '--scrollbar-width': '6px'
          } as React.CSSProperties}
        >
          <div className="p-2 space-y-0.5">
            {TABS_CONFIG.map((tab) => {
              const Icon = tab.icon;
              const isActive = activeTab === tab.id;
              
              return (
                <button
                  key={tab.id}
                  onClick={() => setActiveTab(tab.id)}
                  className={`
                    w-full p-2 rounded-lg transition-all duration-200 text-right
                    flex items-center gap-2
                    ${isActive 
                      ? 'bg-gradient-to-l from-[#3b82f6] to-[#2563eb] text-white border-2 border-[#3b82f6] shadow-md' 
                      : 'bg-white text-gray-700 border border-gray-200 hover:bg-[#eff6ff] hover:shadow-sm'
                    }
                  `}
                  style={{
                    fontFamily: 'Tajawal, sans-serif',
                    fontSize: '12px'
                  }}
                >
                  <Icon className="h-3.5 w-3.5 flex-shrink-0" />
                  <div className="flex-1 text-right">
                    <div>{tab.title}</div>
                    <Badge 
                      variant="outline" 
                      className={`text-[10px] mt-0.5 ${isActive ? 'border-white/50 text-white' : ''}`}
                      style={{ fontFamily: 'monospace' }}
                    >
                      {tab.number}
                    </Badge>
                  </div>
                </button>
              );
            })}
          </div>
        </ScrollArea>
      </div>

      {/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø´Ø§Ø´Ø© */}
      <div className="flex-1">
        <div className="space-y-3">
          {/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */}
          <Card className="card-element card-rtl">
            <CardHeader className="p-3">
              <CardTitle style={{ fontFamily: 'Tajawal, sans-serif' }}>
                <Layout className="h-5 w-5 inline ml-2" />
                Ù…ØµÙ…Ù… Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ ÙˆØ§Ù„Ù†Ù…Ø§Ø°Ø¬
              </CardTitle>
            </CardHeader>
          </Card>

          {/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ§Ø¨ */}
          {renderTabContent()}
        </div>
      </div>

      {/* Ù†Ø§ÙØ°Ø© Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ù„Ø¨/Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯ */}
      <Dialog open={showCreateDialog} onOpenChange={setShowCreateDialog}>
        <DialogContent className="max-w-3xl dialog-rtl">
          <DialogHeader>
            <DialogTitle style={{ fontFamily: 'Tajawal, sans-serif' }}>
              {newTemplate.type === 'template' ? 'Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯' : 'Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯'}
            </DialogTitle>
            <DialogDescription style={{ fontFamily: 'Tajawal, sans-serif' }}>
              Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙŠØ¬Ø¨ Ù…Ù„Ø¤Ù‡Ø§. Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯.
            </DialogDescription>
          </DialogHeader>

          <div className="space-y-3">
            <div className="grid grid-cols-2 gap-3">
              <InputWithCopy
                label="Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨/Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ *"
                id="template-name"
                value={newTemplate.name}
                onChange={(e) => setNewTemplate({ ...newTemplate, name: e.target.value })}
                placeholder="Ù…Ø«Ø§Ù„: Ù‚Ø§Ù„Ø¨ ØµÙˆØ±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ©"
                required
                copyable={true}
                clearable={true}
              />

              <SelectWithCopy
                label="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ†Ø¯ *"
                id="template-docname"
                value={newTemplate.documentNameId}
                onChange={handleDocumentNameChange}
                options={DOCUMENT_NAMES.map(d => ({ value: d.id, label: d.name }))}
                copyable={true}
                clearable={true}
              />
            </div>

            <div className="grid grid-cols-2 gap-3">
              <SelectWithCopy
                label="Ø§Ù„ØªØµÙ†ÙŠÙ *"
                id="template-classification"
                value={newTemplate.classificationId}
                onChange={handleClassificationChange}
                options={CLASSIFICATIONS.map(c => ({ value: c.id, label: c.name }))}
                copyable={true}
                clearable={true}
              />

              <InputWithCopy
                label="Ø§Ù„ÙØ¦Ø©"
                id="template-category"
                value={newTemplate.category}
                onChange={(e) => setNewTemplate({ ...newTemplate, category: e.target.value })}
                placeholder="Ù…Ø«Ø§Ù„: ÙˆØ«Ø§Ø¦Ù‚ Ø´Ø®ØµÙŠØ©"
                copyable={true}
                clearable={true}
              />
            </div>

            <TextAreaWithCopy
              label="Ø§Ù„ÙˆØµÙ"
              id="template-description"
              value={newTemplate.description}
              onChange={(e) => setNewTemplate({ ...newTemplate, description: e.target.value })}
              rows={3}
              placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ù‚Ø§Ù„Ø¨/Ø§Ù„Ù†Ù…ÙˆØ°Ø¬"
              copyable={true}
              clearable={true}
            />

            <div className="grid grid-cols-3 gap-3">
              <SelectWithCopy
                label="Ø§Ù„Ø§ØªØ¬Ø§Ù‡"
                id="template-orientation"
                value={newTemplate.orientation}
                onChange={(value) => setNewTemplate({ ...newTemplate, orientation: value as 'portrait' | 'landscape' })}
                options={[
                  { value: 'portrait', label: 'Ø¹Ù…ÙˆØ¯ÙŠ (Portrait)' },
                  { value: 'landscape', label: 'Ø£ÙÙ‚ÙŠ (Landscape)' }
                ]}
                copyable={false}
                clearable={false}
              />

              <InputWithCopy
                label="Ø§Ù„Ø¹Ø±Ø¶ (mm)"
                id="template-width"
                type="number"
                value={newTemplate.width.toString()}
                onChange={(e) => setNewTemplate({ ...newTemplate, width: parseInt(e.target.value) || 210 })}
                copyable={false}
                clearable={false}
              />

              <InputWithCopy
                label="Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ (mm)"
                id="template-height"
                type="number"
                value={newTemplate.height.toString()}
                onChange={(e) => setNewTemplate({ ...newTemplate, height: parseInt(e.target.value) || 297 })}
                copyable={false}
                clearable={false}
              />
            </div>

            {/* Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙƒÙˆØ¯ */}
            {newTemplate.documentNameCode && (
              <Card className="card-element card-rtl bg-blue-50">
                <CardContent className="p-3">
                  <p className="text-xs mb-1" style={{ fontFamily: 'Tajawal, sans-serif', color: '#2563eb', fontWeight: 700 }}>
                    Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø°ÙŠ Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡:
                  </p>
                  <Badge variant="outline" className="font-mono">
                    {newTemplate.documentNameCode}-{newTemplate.type === 'template' ? 'TPL' : 'FORM'}-{String(templates.filter(t => t.type === newTemplate.type).length + 1).padStart(3, '0')}
                  </Badge>
                </CardContent>
              </Card>
            )}
          </div>

          <DialogFooter>
            <Button variant="outline" onClick={() => setShowCreateDialog(false)} style={{ fontFamily: 'Tajawal, sans-serif' }}>
              Ø¥Ù„ØºØ§Ø¡
            </Button>
            <Button onClick={handleCreateTemplate} style={{ fontFamily: 'Tajawal, sans-serif' }}>
              <Plus className="h-4 w-4 ml-2" />
              Ø¥Ù†Ø´Ø§Ø¡
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
  );
};

export default TemplatesFormsDesigner_Complete_960_v8;
